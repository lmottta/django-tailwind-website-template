{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Configurações - SocialFit{% endblock %}

{% block authenticated_content %}
<div class="max-w-2xl mx-auto p-4">
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-6">Configurações da Conta</h2>
            
            {% if messages %}
                {% for message in messages %}
                    <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% endif %} mb-4">
                        <div class="flex-1">
                            {% if message.tags == 'success' %}
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            {% elif message.tags == 'error' %}
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            {% endif %}
                            <span>{{ message }}</span>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
            
            <form method="post" enctype="multipart/form-data" class="space-y-6">
                {% csrf_token %}
                {{ user_form|crispy }}
                
                <div class="divider">Personalização</div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    <!-- Padrão - Azul Energia -->
                    <label class="cursor-pointer">
                        <input type="radio" name="color_palette" value="default" class="hidden peer" {% if user.color_palette == 'default' %}checked{% endif %}>
                        <div class="card bg-base-100 shadow-xl peer-checked:ring-2 peer-checked:ring-primary peer-checked:ring-offset-2">
                            <div class="card-body p-4">
                                <div class="flex gap-2">
                                    <div class="w-8 h-8 rounded-full bg-primary"></div>
                                    <div class="w-8 h-8 rounded-full bg-secondary"></div>
                                    <div class="w-8 h-8 rounded-full bg-accent"></div>
                                </div>
                                <h3 class="text-sm font-medium mt-2">Padrão - Azul Energia</h3>
                            </div>
                        </div>
                    </label>

                    <!-- Verde Natureza -->
                    <label class="cursor-pointer">
                        <input type="radio" name="color_palette" value="nature" class="hidden peer" {% if user.color_palette == 'nature' %}checked{% endif %}>
                        <div class="card bg-base-100 shadow-xl peer-checked:ring-2 peer-checked:ring-[#2ecc71] peer-checked:ring-offset-2">
                            <div class="card-body p-4">
                                <div class="flex gap-2">
                                    <div class="w-8 h-8 rounded-full bg-[#2ecc71]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#27ae60]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#f1c40f]"></div>
                                </div>
                                <h3 class="text-sm font-medium mt-2">Verde Natureza</h3>
                            </div>
                        </div>
                    </label>

                    <!-- Pôr do Sol -->
                    <label class="cursor-pointer">
                        <input type="radio" name="color_palette" value="sunset" class="hidden peer" {% if user.color_palette == 'sunset' %}checked{% endif %}>
                        <div class="card bg-base-100 shadow-xl peer-checked:ring-2 peer-checked:ring-[#e74c3c] peer-checked:ring-offset-2">
                            <div class="card-body p-4">
                                <div class="flex gap-2">
                                    <div class="w-8 h-8 rounded-full bg-[#e74c3c]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#d35400]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#f39c12]"></div>
                                </div>
                                <h3 class="text-sm font-medium mt-2">Pôr do Sol</h3>
                            </div>
                        </div>
                    </label>

                    <!-- Oceano Profundo -->
                    <label class="cursor-pointer">
                        <input type="radio" name="color_palette" value="ocean" class="hidden peer" {% if user.color_palette == 'ocean' %}checked{% endif %}>
                        <div class="card bg-base-100 shadow-xl peer-checked:ring-2 peer-checked:ring-[#3498db] peer-checked:ring-offset-2">
                            <div class="card-body p-4">
                                <div class="flex gap-2">
                                    <div class="w-8 h-8 rounded-full bg-[#3498db]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#2980b9]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#1abc9c]"></div>
                                </div>
                                <h3 class="text-sm font-medium mt-2">Oceano Profundo</h3>
                            </div>
                        </div>
                    </label>

                    <!-- Frutas Silvestres -->
                    <label class="cursor-pointer">
                        <input type="radio" name="color_palette" value="berry" class="hidden peer" {% if user.color_palette == 'berry' %}checked{% endif %}>
                        <div class="card bg-base-100 shadow-xl peer-checked:ring-2 peer-checked:ring-[#9b59b6] peer-checked:ring-offset-2">
                            <div class="card-body p-4">
                                <div class="flex gap-2">
                                    <div class="w-8 h-8 rounded-full bg-[#9b59b6]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#8e44ad]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#e84393]"></div>
                                </div>
                                <h3 class="text-sm font-medium mt-2">Frutas Silvestres</h3>
                            </div>
                        </div>
                    </label>

                    <!-- Monocromático -->
                    <label class="cursor-pointer">
                        <input type="radio" name="color_palette" value="monochrome" class="hidden peer" {% if user.color_palette == 'monochrome' %}checked{% endif %}>
                        <div class="card bg-base-100 shadow-xl peer-checked:ring-2 peer-checked:ring-[#34495e] peer-checked:ring-offset-2">
                            <div class="card-body p-4">
                                <div class="flex gap-2">
                                    <div class="w-8 h-8 rounded-full bg-[#34495e]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#2c3e50]"></div>
                                    <div class="w-8 h-8 rounded-full bg-[#95a5a6]"></div>
                                </div>
                                <h3 class="text-sm font-medium mt-2">Monocromático</h3>
                            </div>
                        </div>
                    </label>
                </div>

                <div class="divider">Preferências de Notificação</div>
                
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Receber notificações por e-mail</span>
                        <input type="checkbox" name="email_notifications" class="toggle toggle-primary" {% if user.email_notifications %}checked{% endif %}>
                    </label>
                </div>
                
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Notificações de novos seguidores</span>
                        <input type="checkbox" name="follower_notifications" class="toggle toggle-primary" {% if user.follower_notifications %}checked{% endif %}>
                    </label>
                </div>
                
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Notificações de treinos</span>
                        <input type="checkbox" name="workout_notifications" class="toggle toggle-primary" {% if user.workout_notifications %}checked{% endif %}>
                    </label>
                </div>
                
                <div class="divider">Privacidade</div>
                
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Perfil privado</span>
                        <input type="checkbox" name="private_profile" class="toggle toggle-primary" {% if user.private_profile %}checked{% endif %}>
                    </label>
                </div>
                
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Mostrar estatísticas de treino</span>
                        <input type="checkbox" name="show_workout_stats" class="toggle toggle-primary" {% if user.show_workout_stats %}checked{% endif %}>
                    </label>
                </div>
                
                <div class="divider">Segurança</div>
                
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Autenticação de dois fatores</span>
                        <input type="checkbox" name="two_factor_auth" class="toggle toggle-primary" {% if user.two_factor_auth %}checked{% endif %}>
                    </label>
                </div>
                
                <div class="form-control">
                    <label class="label cursor-pointer">
                        <span class="label-text">Notificações de login</span>
                        <input type="checkbox" name="login_notifications" class="toggle toggle-primary" {% if user.login_notifications %}checked{% endif %}>
                    </label>
                </div>
                
                <div class="card-actions justify-end mt-6">
                    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                </div>
            </form>
            
            <div class="divider">Zona de Perigo</div>
            
            <div class="bg-error/10 rounded-lg p-4 space-y-4">
                <h3 class="font-bold text-error">Excluir Conta</h3>
                <p class="text-sm text-error/80">
                    Ao excluir sua conta, todos os seus dados serão permanentemente removidos. 
                    Esta ação não pode ser desfeita.
                </p>
                <button class="btn btn-error btn-outline" onclick="document.getElementById('delete-modal').showModal()">
                    Excluir Minha Conta
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
<dialog id="delete-modal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg text-error">Confirmar Exclusão</h3>
        <p class="py-4">
            Você tem certeza que deseja excluir sua conta? Esta ação não pode ser desfeita.
        </p>
        <div class="modal-action">
            <form method="dialog">
                <button class="btn">Cancelar</button>
            </form>
            <form method="post" action="{% url 'delete_account' %}" class="inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-error">Excluir Permanentemente</button>
            </form>
        </div>
    </div>
</dialog>
{% endblock %}
